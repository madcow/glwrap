#include "glwrap.h"
#include <stddef.h>

#ifdef _WIN32
#define WIN32_LEAN_AND_MEAN
#undef APIENTRY
#include <windows.h>
// Use Windows WGL implementation of GetProcAddress()
#define GetAddress(name) wglGetProcAddress((LPCSTR)name)
#else
#include <GL/glx.h>
// Use Linux GLX implementation of GetProcAddress()
extern void (*glXGetProcAddressARB(const GLubyte *procName))();
#define GetAddress(name) (*glXGetProcAddressARB)((const GLubyte*) name)
#endif

// Load function and check for driver dependent error return values
#define GetFunc(type, name) name##_ptr = (type) GetAddress(#name); \
if (name == (type) 0 || name == (type) -1 || name == (type) 1 || \
    name == (type) 2 || name == (type) 3) \
	return -1;

int glInit(void)
{
	GetFunc(PFNGLACTIVETEXTUREPROC, glActiveTexture);
	GetFunc(PFNGLATTACHSHADERPROC, glAttachShader);
	GetFunc(PFNGLBINDATTRIBLOCATIONPROC, glBindAttribLocation);
	GetFunc(PFNGLBINDBUFFERPROC, glBindBuffer);
	GetFunc(PFNGLBINDTEXTUREPROC, glBindTexture);
	GetFunc(PFNGLBLENDCOLORPROC, glBlendColor);
	GetFunc(PFNGLBLENDEQUATIONPROC, glBlendEquation);
	GetFunc(PFNGLBLENDEQUATIONSEPARATEPROC, glBlendEquationSeparate);
	GetFunc(PFNGLBLENDFUNCPROC, glBlendFunc);
	GetFunc(PFNGLBLENDFUNCSEPARATEPROC, glBlendFuncSeparate);
	GetFunc(PFNGLBUFFERDATAPROC, glBufferData);
	GetFunc(PFNGLBUFFERSUBDATAPROC, glBufferSubData);
	GetFunc(PFNGLCLEARCOLORPROC, glClearColor);
	GetFunc(PFNGLCLEARPROC, glClear);
	GetFunc(PFNGLCLEARSTENCILPROC, glClearStencil);
	GetFunc(PFNGLCOLORMASKPROC, glColorMask);
	GetFunc(PFNGLCOMPILESHADERPROC, glCompileShader);
	GetFunc(PFNGLCOMPRESSEDTEXIMAGE2DPROC, glCompressedTexImage2D);
	GetFunc(PFNGLCOMPRESSEDTEXSUBIMAGE2DPROC, glCompressedTexSubImage2D);
	GetFunc(PFNGLCOPYTEXIMAGE2DPROC, glCopyTexImage2D);
	GetFunc(PFNGLCOPYTEXSUBIMAGE2DPROC, glCopyTexSubImage2D);
	GetFunc(PFNGLCREATEPROGRAMPROC, glCreateProgram);
	GetFunc(PFNGLCREATESHADERPROC, glCreateShader);
	GetFunc(PFNGLCULLFACEPROC, glCullFace);
	GetFunc(PFNGLDELETEBUFFERSPROC, glDeleteBuffers);
	GetFunc(PFNGLDELETEPROGRAMPROC, glDeleteProgram);
	GetFunc(PFNGLDELETESHADERPROC, glDeleteShader);
	GetFunc(PFNGLDELETETEXTURESPROC, glDeleteTextures);
	GetFunc(PFNGLDEPTHFUNCPROC, glDepthFunc);
	GetFunc(PFNGLDEPTHMASKPROC, glDepthMask);
	GetFunc(PFNGLDETACHSHADERPROC, glDetachShader);
	GetFunc(PFNGLDISABLEPROC, glDisable);
	GetFunc(PFNGLDISABLEVERTEXATTRIBARRAYPROC, glDisableVertexAttribArray);
	GetFunc(PFNGLDRAWARRAYSPROC, glDrawArrays);
	GetFunc(PFNGLDRAWELEMENTSPROC, glDrawElements);
	GetFunc(PFNGLENABLEPROC, glEnable);
	GetFunc(PFNGLENABLEVERTEXATTRIBARRAYPROC, glEnableVertexAttribArray);
	GetFunc(PFNGLFINISHPROC, glFinish);
	GetFunc(PFNGLFLUSHPROC, glFlush);
	GetFunc(PFNGLFRONTFACEPROC, glFrontFace);
	GetFunc(PFNGLGENBUFFERSPROC, glGenBuffers);
	GetFunc(PFNGLGENTEXTURESPROC, glGenTextures);
	GetFunc(PFNGLGETACTIVEATTRIBPROC, glGetActiveAttrib);
	GetFunc(PFNGLGETACTIVEUNIFORMPROC, glGetActiveUniform);
	GetFunc(PFNGLGETATTACHEDSHADERSPROC, glGetAttachedShaders);
	GetFunc(PFNGLGETATTRIBLOCATIONPROC, glGetAttribLocation);
	GetFunc(PFNGLGETBOOLEANVPROC, glGetBooleanv);
	GetFunc(PFNGLGETBUFFERPARAMETERIVPROC, glGetBufferParameteriv);
	GetFunc(PFNGLGETERRORPROC, glGetError);
	GetFunc(PFNGLGETFLOATVPROC, glGetFloatv);
	GetFunc(PFNGLGETINTEGERVPROC, glGetIntegerv);
	GetFunc(PFNGLGETPROGRAMINFOLOGPROC, glGetProgramInfoLog);
	GetFunc(PFNGLGETPROGRAMIVPROC, glGetProgramiv);
	GetFunc(PFNGLGETSHADERINFOLOGPROC, glGetShaderInfoLog);
	GetFunc(PFNGLGETSHADERIVPROC, glGetShaderiv);
	GetFunc(PFNGLGETSHADERSOURCEPROC, glGetShaderSource);
	GetFunc(PFNGLGETSTRINGPROC, glGetString);
	GetFunc(PFNGLGETTEXPARAMETERFVPROC, glGetTexParameterfv);
	GetFunc(PFNGLGETTEXPARAMETERIVPROC, glGetTexParameteriv);
	GetFunc(PFNGLGETUNIFORMFVPROC, glGetUniformfv);
	GetFunc(PFNGLGETUNIFORMIVPROC, glGetUniformiv);
	GetFunc(PFNGLGETUNIFORMLOCATIONPROC, glGetUniformLocation);
	GetFunc(PFNGLGETVERTEXATTRIBFVPROC, glGetVertexAttribfv);
	GetFunc(PFNGLGETVERTEXATTRIBIVPROC, glGetVertexAttribiv);
	GetFunc(PFNGLGETVERTEXATTRIBPOINTERVPROC, glGetVertexAttribPointerv);
	GetFunc(PFNGLHINTPROC, glHint);
	GetFunc(PFNGLISBUFFERPROC, glIsBuffer);
	GetFunc(PFNGLISENABLEDPROC, glIsEnabled);
	GetFunc(PFNGLISPROGRAMPROC, glIsProgram);
	GetFunc(PFNGLISSHADERPROC, glIsShader);
	GetFunc(PFNGLISTEXTUREPROC, glIsTexture);
	GetFunc(PFNGLLINEWIDTHPROC, glLineWidth);
	GetFunc(PFNGLLINKPROGRAMPROC, glLinkProgram);
	GetFunc(PFNGLPIXELSTOREIPROC, glPixelStorei);
	GetFunc(PFNGLPOLYGONOFFSETPROC, glPolygonOffset);
	GetFunc(PFNGLREADPIXELSPROC, glReadPixels);
	GetFunc(PFNGLSAMPLECOVERAGEPROC, glSampleCoverage);
	GetFunc(PFNGLSCISSORPROC, glScissor);
	GetFunc(PFNGLSHADERSOURCEPROC, glShaderSource);
	GetFunc(PFNGLSTENCILFUNCPROC, glStencilFunc);
	GetFunc(PFNGLSTENCILFUNCSEPARATEPROC, glStencilFuncSeparate);
	GetFunc(PFNGLSTENCILMASKPROC, glStencilMask);
	GetFunc(PFNGLSTENCILMASKSEPARATEPROC, glStencilMaskSeparate);
	GetFunc(PFNGLSTENCILOPPROC, glStencilOp);
	GetFunc(PFNGLSTENCILOPSEPARATEPROC, glStencilOpSeparate);
	GetFunc(PFNGLTEXIMAGE2DPROC, glTexImage2D);
	GetFunc(PFNGLTEXPARAMETERFPROC, glTexParameterf);
	GetFunc(PFNGLTEXPARAMETERFVPROC, glTexParameterfv);
	GetFunc(PFNGLTEXPARAMETERIPROC, glTexParameteri);
	GetFunc(PFNGLTEXPARAMETERIVPROC, glTexParameteriv);
	GetFunc(PFNGLTEXSUBIMAGE2DPROC, glTexSubImage2D);
	GetFunc(PFNGLUNIFORM1FPROC, glUniform1f);
	GetFunc(PFNGLUNIFORM1FVPROC, glUniform1fv);
	GetFunc(PFNGLUNIFORM1IPROC, glUniform1i);
	GetFunc(PFNGLUNIFORM1IVPROC, glUniform1iv);
	GetFunc(PFNGLUNIFORM2FPROC, glUniform2f);
	GetFunc(PFNGLUNIFORM2FVPROC, glUniform2fv);
	GetFunc(PFNGLUNIFORM2IPROC, glUniform2i);
	GetFunc(PFNGLUNIFORM2IVPROC, glUniform2iv);
	GetFunc(PFNGLUNIFORM3FPROC, glUniform3f);
	GetFunc(PFNGLUNIFORM3FVPROC, glUniform3fv);
	GetFunc(PFNGLUNIFORM3IPROC, glUniform3i);
	GetFunc(PFNGLUNIFORM3IVPROC, glUniform3iv);
	GetFunc(PFNGLUNIFORM4FPROC, glUniform4f);
	GetFunc(PFNGLUNIFORM4FVPROC, glUniform4fv);
	GetFunc(PFNGLUNIFORM4IPROC, glUniform4i);
	GetFunc(PFNGLUNIFORM4IVPROC, glUniform4iv);
	GetFunc(PFNGLUNIFORMMATRIX2FVPROC, glUniformMatrix2fv);
	GetFunc(PFNGLUNIFORMMATRIX3FVPROC, glUniformMatrix3fv);
	GetFunc(PFNGLUNIFORMMATRIX4FVPROC, glUniformMatrix4fv);
	GetFunc(PFNGLUSEPROGRAMPROC, glUseProgram);
	GetFunc(PFNGLVALIDATEPROGRAMPROC, glValidateProgram);
	GetFunc(PFNGLVERTEXATTRIB1FPROC, glVertexAttrib1f);
	GetFunc(PFNGLVERTEXATTRIB1FVPROC, glVertexAttrib1fv);
	GetFunc(PFNGLVERTEXATTRIB2FPROC, glVertexAttrib2f);
	GetFunc(PFNGLVERTEXATTRIB2FVPROC, glVertexAttrib2fv);
	GetFunc(PFNGLVERTEXATTRIB3FPROC, glVertexAttrib3f);
	GetFunc(PFNGLVERTEXATTRIB3FVPROC, glVertexAttrib3fv);
	GetFunc(PFNGLVERTEXATTRIB4FPROC, glVertexAttrib4f);
	GetFunc(PFNGLVERTEXATTRIB4FVPROC, glVertexAttrib4fv);
	GetFunc(PFNGLVERTEXATTRIBPOINTERPROC, glVertexAttribPointer);
	GetFunc(PFNGLVIEWPORTPROC, glViewport);

	return 0;
}

PFNGLACTIVETEXTUREPROC glActiveTexture_ptr = NULL;
PFNGLATTACHSHADERPROC glAttachShader_ptr = NULL;
PFNGLBINDATTRIBLOCATIONPROC glBindAttribLocation_ptr = NULL;
PFNGLBINDBUFFERPROC glBindBuffer_ptr = NULL;
PFNGLBINDTEXTUREPROC glBindTexture_ptr = NULL;
PFNGLBLENDCOLORPROC glBlendColor_ptr = NULL;
PFNGLBLENDEQUATIONPROC glBlendEquation_ptr = NULL;
PFNGLBLENDEQUATIONSEPARATEPROC glBlendEquationSeparate_ptr = NULL;
PFNGLBLENDFUNCPROC glBlendFunc_ptr = NULL;
PFNGLBLENDFUNCSEPARATEPROC glBlendFuncSeparate_ptr = NULL;
PFNGLBUFFERDATAPROC glBufferData_ptr = NULL;
PFNGLBUFFERSUBDATAPROC glBufferSubData_ptr = NULL;
PFNGLCLEARCOLORPROC glClearColor_ptr = NULL;
PFNGLCLEARPROC glClear_ptr = NULL;
PFNGLCLEARSTENCILPROC glClearStencil_ptr = NULL;
PFNGLCOLORMASKPROC glColorMask_ptr = NULL;
PFNGLCOMPILESHADERPROC glCompileShader_ptr = NULL;
PFNGLCOMPRESSEDTEXIMAGE2DPROC glCompressedTexImage2D_ptr = NULL;
PFNGLCOMPRESSEDTEXSUBIMAGE2DPROC glCompressedTexSubImage2D_ptr = NULL;
PFNGLCOPYTEXIMAGE2DPROC glCopyTexImage2D_ptr = NULL;
PFNGLCOPYTEXSUBIMAGE2DPROC glCopyTexSubImage2D_ptr = NULL;
PFNGLCREATEPROGRAMPROC glCreateProgram_ptr = NULL;
PFNGLCREATESHADERPROC glCreateShader_ptr = NULL;
PFNGLCULLFACEPROC glCullFace_ptr = NULL;
PFNGLDELETEBUFFERSPROC glDeleteBuffers_ptr = NULL;
PFNGLDELETEPROGRAMPROC glDeleteProgram_ptr = NULL;
PFNGLDELETESHADERPROC glDeleteShader_ptr = NULL;
PFNGLDELETETEXTURESPROC glDeleteTextures_ptr = NULL;
PFNGLDEPTHFUNCPROC glDepthFunc_ptr = NULL;
PFNGLDEPTHMASKPROC glDepthMask_ptr = NULL;
PFNGLDETACHSHADERPROC glDetachShader_ptr = NULL;
PFNGLDISABLEPROC glDisable_ptr = NULL;
PFNGLDISABLEVERTEXATTRIBARRAYPROC glDisableVertexAttribArray_ptr = NULL;
PFNGLDRAWARRAYSPROC glDrawArrays_ptr = NULL;
PFNGLDRAWELEMENTSPROC glDrawElements_ptr = NULL;
PFNGLENABLEPROC glEnable_ptr = NULL;
PFNGLENABLEVERTEXATTRIBARRAYPROC glEnableVertexAttribArray_ptr = NULL;
PFNGLFINISHPROC glFinish_ptr = NULL;
PFNGLFLUSHPROC glFlush_ptr = NULL;
PFNGLFRONTFACEPROC glFrontFace_ptr = NULL;
PFNGLGENBUFFERSPROC glGenBuffers_ptr = NULL;
PFNGLGENTEXTURESPROC glGenTextures_ptr = NULL;
PFNGLGETACTIVEATTRIBPROC glGetActiveAttrib_ptr = NULL;
PFNGLGETACTIVEUNIFORMPROC glGetActiveUniform_ptr = NULL;
PFNGLGETATTACHEDSHADERSPROC glGetAttachedShaders_ptr = NULL;
PFNGLGETATTRIBLOCATIONPROC glGetAttribLocation_ptr = NULL;
PFNGLGETBOOLEANVPROC glGetBooleanv_ptr = NULL;
PFNGLGETBUFFERPARAMETERIVPROC glGetBufferParameteriv_ptr = NULL;
PFNGLGETERRORPROC glGetError_ptr = NULL;
PFNGLGETFLOATVPROC glGetFloatv_ptr = NULL;
PFNGLGETINTEGERVPROC glGetIntegerv_ptr = NULL;
PFNGLGETPROGRAMINFOLOGPROC glGetProgramInfoLog_ptr = NULL;
PFNGLGETPROGRAMIVPROC glGetProgramiv_ptr = NULL;
PFNGLGETSHADERINFOLOGPROC glGetShaderInfoLog_ptr = NULL;
PFNGLGETSHADERIVPROC glGetShaderiv_ptr = NULL;
PFNGLGETSHADERSOURCEPROC glGetShaderSource_ptr = NULL;
PFNGLGETSTRINGPROC glGetString_ptr = NULL;
PFNGLGETTEXPARAMETERFVPROC glGetTexParameterfv_ptr = NULL;
PFNGLGETTEXPARAMETERIVPROC glGetTexParameteriv_ptr = NULL;
PFNGLGETUNIFORMFVPROC glGetUniformfv_ptr = NULL;
PFNGLGETUNIFORMIVPROC glGetUniformiv_ptr = NULL;
PFNGLGETUNIFORMLOCATIONPROC glGetUniformLocation_ptr = NULL;
PFNGLGETVERTEXATTRIBFVPROC glGetVertexAttribfv_ptr = NULL;
PFNGLGETVERTEXATTRIBIVPROC glGetVertexAttribiv_ptr = NULL;
PFNGLGETVERTEXATTRIBPOINTERVPROC glGetVertexAttribPointerv_ptr = NULL;
PFNGLHINTPROC glHint_ptr = NULL;
PFNGLISBUFFERPROC glIsBuffer_ptr = NULL;
PFNGLISENABLEDPROC glIsEnabled_ptr = NULL;
PFNGLISPROGRAMPROC glIsProgram_ptr = NULL;
PFNGLISSHADERPROC glIsShader_ptr = NULL;
PFNGLISTEXTUREPROC glIsTexture_ptr = NULL;
PFNGLLINEWIDTHPROC glLineWidth_ptr = NULL;
PFNGLLINKPROGRAMPROC glLinkProgram_ptr = NULL;
PFNGLPIXELSTOREIPROC glPixelStorei_ptr = NULL;
PFNGLPOLYGONOFFSETPROC glPolygonOffset_ptr = NULL;
PFNGLREADPIXELSPROC glReadPixels_ptr = NULL;
PFNGLSAMPLECOVERAGEPROC glSampleCoverage_ptr = NULL;
PFNGLSCISSORPROC glScissor_ptr = NULL;
PFNGLSHADERSOURCEPROC glShaderSource_ptr = NULL;
PFNGLSTENCILFUNCPROC glStencilFunc_ptr = NULL;
PFNGLSTENCILFUNCSEPARATEPROC glStencilFuncSeparate_ptr = NULL;
PFNGLSTENCILMASKPROC glStencilMask_ptr = NULL;
PFNGLSTENCILMASKSEPARATEPROC glStencilMaskSeparate_ptr = NULL;
PFNGLSTENCILOPPROC glStencilOp_ptr = NULL;
PFNGLSTENCILOPSEPARATEPROC glStencilOpSeparate_ptr = NULL;
PFNGLTEXIMAGE2DPROC glTexImage2D_ptr = NULL;
PFNGLTEXPARAMETERFPROC glTexParameterf_ptr = NULL;
PFNGLTEXPARAMETERFVPROC glTexParameterfv_ptr = NULL;
PFNGLTEXPARAMETERIPROC glTexParameteri_ptr = NULL;
PFNGLTEXPARAMETERIVPROC glTexParameteriv_ptr = NULL;
PFNGLTEXSUBIMAGE2DPROC glTexSubImage2D_ptr = NULL;
PFNGLUNIFORM1FPROC glUniform1f_ptr = NULL;
PFNGLUNIFORM1FVPROC glUniform1fv_ptr = NULL;
PFNGLUNIFORM1IPROC glUniform1i_ptr = NULL;
PFNGLUNIFORM1IVPROC glUniform1iv_ptr = NULL;
PFNGLUNIFORM2FPROC glUniform2f_ptr = NULL;
PFNGLUNIFORM2FVPROC glUniform2fv_ptr = NULL;
PFNGLUNIFORM2IPROC glUniform2i_ptr = NULL;
PFNGLUNIFORM2IVPROC glUniform2iv_ptr = NULL;
PFNGLUNIFORM3FPROC glUniform3f_ptr = NULL;
PFNGLUNIFORM3FVPROC glUniform3fv_ptr = NULL;
PFNGLUNIFORM3IPROC glUniform3i_ptr = NULL;
PFNGLUNIFORM3IVPROC glUniform3iv_ptr = NULL;
PFNGLUNIFORM4FPROC glUniform4f_ptr = NULL;
PFNGLUNIFORM4FVPROC glUniform4fv_ptr = NULL;
PFNGLUNIFORM4IPROC glUniform4i_ptr = NULL;
PFNGLUNIFORM4IVPROC glUniform4iv_ptr = NULL;
PFNGLUNIFORMMATRIX2FVPROC glUniformMatrix2fv_ptr = NULL;
PFNGLUNIFORMMATRIX3FVPROC glUniformMatrix3fv_ptr = NULL;
PFNGLUNIFORMMATRIX4FVPROC glUniformMatrix4fv_ptr = NULL;
PFNGLUSEPROGRAMPROC glUseProgram_ptr = NULL;
PFNGLVALIDATEPROGRAMPROC glValidateProgram_ptr = NULL;
PFNGLVERTEXATTRIB1FPROC glVertexAttrib1f_ptr = NULL;
PFNGLVERTEXATTRIB1FVPROC glVertexAttrib1fv_ptr = NULL;
PFNGLVERTEXATTRIB2FPROC glVertexAttrib2f_ptr = NULL;
PFNGLVERTEXATTRIB2FVPROC glVertexAttrib2fv_ptr = NULL;
PFNGLVERTEXATTRIB3FPROC glVertexAttrib3f_ptr = NULL;
PFNGLVERTEXATTRIB3FVPROC glVertexAttrib3fv_ptr = NULL;
PFNGLVERTEXATTRIB4FPROC glVertexAttrib4f_ptr = NULL;
PFNGLVERTEXATTRIB4FVPROC glVertexAttrib4fv_ptr = NULL;
PFNGLVERTEXATTRIBPOINTERPROC glVertexAttribPointer_ptr = NULL;
PFNGLVIEWPORTPROC glViewport_ptr = NULL;
